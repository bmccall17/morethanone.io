# Ralphy Progress Log

- [✓] 2026-02-08 22:11 - Create a Supabase Realtime helper at `src/lib/realtime.ts` that exports a `subscribeToRound(roundId, callbacks)` function. It should subscribe to the `rounds` table filtered by `id=roundId` and call `onStatusChange(status)` when the row's `status` column changes. Return an unsubscribe function. Use the existing browser Supabase client from `src/lib/supabase/client.ts`.
- [✓] 2026-02-08 22:12 - Create a Supabase Realtime subscription helper for participants at `src/lib/realtime.ts` (add to existing file). Export `subscribeToParticipants(roundId, callbacks)` that listens for INSERT events on the `participants` table filtered by `round_id=roundId`. Call `onPlayerJoined(participant)` for each new row. Return an unsubscribe function.
- [✓] 2026-02-08 22:14 - Create a Supabase Realtime subscription helper for rankings at `src/lib/realtime.ts` (add to existing file). Export `subscribeToRankings(roundId, callbacks)` that listens for INSERT and UPDATE events on the `rankings` table filtered by `round_id=roundId`. Call `onRankingSubmitted(ranking)` for each event. Return an unsubscribe function.
- [✓] 2026-02-08 22:17 - Refactor `/host/[roundId]/lobby/page.tsx` to replace the 3-second polling interval for participants with the `subscribeToParticipants()` realtime subscription. Remove the `setInterval` for participant fetching. Keep the initial fetch on mount but use realtime for subsequent updates. Clean up the subscription on unmount.
- [✓] 2026-02-08 22:19 - Refactor `/host/[roundId]/lobby/page.tsx` to replace the 3-second polling interval for ranking count with the `subscribeToRankings()` realtime subscription. Instead of polling the rankings count endpoint, increment the local count each time `onRankingSubmitted` fires. Keep the initial count fetch on mount.
- [✓] 2026-02-08 22:22 - Refactor `/host/[roundId]/lobby/page.tsx` to use `subscribeToRound()` for round status changes instead of polling. When status changes to 'revealed', auto-redirect to the reveal page. Remove any remaining `setInterval` calls.
- [✓] 2026-02-08 22:24 - Refactor `/round/[roundId]/rank/page.tsx` to replace the 3-second status polling with `subscribeToRound()`. When the round status changes from 'setup' to 'ranking', show the ranking form. Clean up subscription on unmount. Remove the `setInterval`.
- [✓] 2026-02-08 22:27 - Refactor `/round/[roundId]/waiting/page.tsx` to replace the 3-second status polling with `subscribeToRound()`. When status changes to 'revealed', redirect to the player reveal page. Remove the `setInterval`.
