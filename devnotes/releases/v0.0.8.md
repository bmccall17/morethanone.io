# v0.0.8 - analytics, sounds, metrics & run it again

**released:** feb 11, 2026

## summary
Sprint 7 adds observability (analytics events + admin metrics dashboard), delight (drag sounds & haptics), a proper server-side "Run it again" replay flow with participant notifications, and pre-populated poll templates for hosts.

---

## changes
- Analytics instrumentation: 6 custom events tracked to Supabase `events` table (round_created, player_joined, ballot_submitted, round_closed, results_revealed, replay_created)
- Vercel Analytics for page views and web vitals
- Drag sounds via Web Audio API oscillators (pick up, reorder, drop) with haptic feedback on Android
- Admin metrics dashboard at `/admin/metrics` with bearer token auth — shows completion rates, convergence distribution, tie-break frequency, avg time to converge, and recent rounds table
- Server-side "Run it again" replay API — creates new round with same settings, links rounds via previous/next pointers, notifies participants via realtime
- Participants on reveal/waiting pages see a "Join next round" notification with pre-filled name
- Pre-populated poll templates on host create page (Games You Love, Best Movie of All Time, Team Lunch)
- Bot RNG improvement — time-seeded LCG shuffle per bot for better ranking variation
- Fixed host token read bug on reveal page (wrong localStorage key)

---

## files changed

### new files
- `src/lib/analytics.ts` - server-side trackEvent() fire-and-forget
- `src/lib/analytics-client.ts` - client-side trackClientEvent() via /api/events
- `src/app/api/events/route.ts` - POST handler for client analytics events
- `src/lib/sounds.ts` - Web Audio API synthesized drag sounds + vibrate() wrapper
- `src/components/metrics/StatCard.tsx` - big number stat card component
- `src/components/metrics/BarChart.tsx` - horizontal bar chart with Tailwind widths
- `src/app/api/admin/metrics/route.ts` - GET metrics aggregation with bearer auth
- `src/app/admin/metrics/page.tsx` - admin metrics dashboard page
- `src/app/api/rounds/replay/route.ts` - POST replay API (creates linked round copy)
- `src/components/ReplayNotification.tsx` - "host started a new round" banner
- `supabase/migrations/add_events_table.sql` - events table migration
- `supabase/migrations/add_round_replay_columns.sql` - replay columns migration

### modified files
- `supabase/schema.sql` - added events table, previous_round_id, next_round_id columns
- `src/types/database.ts` - added previous_round_id, next_round_id to Round interface
- `src/app/layout.tsx` - added Vercel Analytics component
- `src/app/api/rounds/route.ts` - instrument round_created event
- `src/app/api/rounds/join/route.ts` - instrument player_joined event
- `src/app/api/rounds/[roundId]/rankings/route.ts` - instrument ballot_submitted event
- `src/app/api/rounds/[roundId]/close/route.ts` - instrument round_closed event
- `src/app/api/rounds/[roundId]/reveal/route.ts` - instrument results_revealed event
- `src/app/api/rounds/[roundId]/route.ts` - include replay columns in GET response
- `src/components/DraggableRankList.tsx` - added drag sound handlers (onDragStart, onDragOver, onDragEnd)
- `src/lib/realtime.ts` - extended RoundCallbacks with onNextRound for replay detection
- `src/app/host/[roundId]/reveal/page.tsx` - replaced URL-param "Run it again" with replay API call, fixed host token read
- `src/app/round/[roundId]/reveal/page.tsx` - added replay subscription + ReplayNotification
- `src/app/round/[roundId]/waiting/page.tsx` - added replay detection + ReplayNotification
- `src/app/join/page.tsx` - accept `name` search param for pre-fill
- `src/app/host/create/page.tsx` - added poll template picker
- `src/app/api/rounds/[roundId]/start/route.ts` - improved bot RNG with time-seeded LCG
- `package.json` / `package-lock.json` - added @vercel/analytics

---

## documentation reconciliation
- Removed shipped items from `prdnextsteps.md`: drag sounds/haptics, analytics instrumentation, metrics dashboard, "run it again" improvements
- Removed shipped items from `prdparkinglot.md`: analytics and "run it again" entries
- Created `devnotes/sprint-7-backlog.md` with all tasks checked off
- Added sprint 7 shipping note to `prdnextsteps.md`
- Remaining in prdnextsteps.md: "felt fair?" pulse, Pol.is integration, shareable result card, iOS/Android touch testing

---

## verification
- [ ] `npm run build` passes
- [ ] `npm test` passes
- [ ] Vercel deployment live
- [ ] Supabase schema matches `supabase/schema.sql`
- [ ] Supabase migrations run: `add_events_table.sql`, `add_round_replay_columns.sql`
- [ ] `METRICS_SECRET` env var set in Vercel
