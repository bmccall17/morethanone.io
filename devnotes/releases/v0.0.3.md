# v0.0.3 - host controls complete (share + bug fixes)

**released:** feb 9, 2026

## summary
Completes sections 2-3 of the host controls sprint: fixes the P0 status constraint bug blocking processing flow, adds the share results flow with public results page and clipboard sharing, and fixes multiple timing/race condition bugs in the live processing feature. Demo mode (section 4) deferred to a separate sprint.

---

## changes
- Fixed `rounds_status_check` constraint to allow `'processing'` and `'revealed'` statuses
- Added `share_url` column to results table
- Both reveal and process API routes now compute and store `share_url` on result upsert
- Created public results page at `/results/[roundId]` — no auth, standalone shareable link
- Replaced html2canvas PNG download with clipboard copy on both host and participant reveal pages
- Fixed host lobby missing UI for `'processing'` state — added badge + "Run processing" button
- Removed auto-trigger of process API from close handler (was causing race condition)
- Added 1.5s delay between processing rounds so realtime events propagate to participants
- Fixed participant waiting page not redirecting when round already in `'processing'` status on load
- Fixed participant processing page not handling `'closed'` status (processing complete, awaiting reveal)
- Updated `Result` type with optional `share_url` field

---

## files changed

### new files
- `supabase/migrations/fix_status_check_constraint.sql` - allow processing/revealed in status constraint
- `supabase/migrations/add_share_url_column.sql` - share_url text column on results
- `src/app/results/[roundId]/page.tsx` - public shareable results page

### modified files
- `src/types/database.ts` - added `share_url` to Result interface
- `src/app/api/rounds/[roundId]/reveal/route.ts` - compute and store share_url
- `src/app/api/rounds/[roundId]/process/route.ts` - compute share_url, add 1.5s round delay
- `src/app/host/[roundId]/lobby/page.tsx` - processing badge, Run processing button, removed auto-trigger
- `src/app/host/[roundId]/reveal/page.tsx` - replaced html2canvas with clipboard share
- `src/app/round/[roundId]/reveal/page.tsx` - replaced html2canvas with clipboard share
- `src/app/round/[roundId]/waiting/page.tsx` - initial status check for redirect on load
- `src/app/round/[roundId]/processing/page.tsx` - handle closed status, initial status check
- `devnotes/sprint-hostcontrols-backlog.md` - sections 2-3 checked off, demo deferred

---

## verification
- [x] `npm run build` passes
- [ ] Vercel deployment live
- [ ] Supabase migrations applied (fix_status_check_constraint, add_share_url_column, add_processing_columns)
