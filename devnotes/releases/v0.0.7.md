# v0.0.7 - polish + safety

**released:** feb 11, 2026

## summary

Sprint 6 complete: host moderation tools (remove players and options), profanity filter, ranking timer with countdown and auto-close, max ranks setting, fun name generator, 3-2-1 countdown reveal overlay, and edge case fixes across all reveal views.

---

## changes

### moderation + safety
- host can remove participants during setup and ranking phases (API + UI button in PlayerList)
- host can remove options during setup (API + X button in lobby options list)
- profanity filter blocks inappropriate display names on join and option text on create (hardcoded blocklist, 400 error with user-friendly message)

### ranking UX
- ranking timer: host sets duration in minutes on create, countdown visible to host and participants, auto-closes ranking on expiry, host can still close early
- max ranks setting: host limits how many options participants can rank, enforced client-side in DraggableRankList and server-side in rankings API
- fun name generator: "Random name" button on join page generates adjective + animal combos (e.g. "Brave Otter")

### reveal polish
- 3...2...1 countdown overlay before reveal results on both host and participant reveal pages
- edge case fixes: single-round results (majority on first count), anonymous mode name leaks in selection grid, tie-break info display across all three reveal views

### infrastructure
- new migration: `ranking_started_at` column on rounds table (required for timer deadline calculation)
- `reveal_view_state` and `ranking_started_at` added to canonical `schema.sql`
- realtime subscription for participant removal events

---

## files changed

### new files
- `src/app/api/rounds/[roundId]/participants/[participantId]/remove/route.ts` - remove participant API
- `src/app/api/rounds/[roundId]/options/remove/route.ts` - remove option API
- `src/lib/profanity.ts` - profanity filter utility
- `src/lib/fun-names.ts` - random name generator
- `src/components/CountdownTimer.tsx` - ranking timer component
- `src/components/RevealCountdown.tsx` - 3-2-1 reveal countdown overlay
- `supabase/migrations/add_timer_minutes_setting.sql` - ranking_started_at column migration
- 8 new test files covering all new features and reveal edge cases

### modified files
- `src/app/host/[roundId]/lobby/page.tsx` - remove option buttons, timer display, max_ranks prop
- `src/app/host/create/page.tsx` - timer and max ranks inputs in settings
- `src/app/join/page.tsx` - random name button
- `src/app/round/[roundId]/rank/page.tsx` - timer countdown, time's up state
- `src/app/host/[roundId]/reveal/page.tsx` - countdown overlay, edge case fixes
- `src/app/round/[roundId]/reveal/page.tsx` - countdown overlay, edge case fixes
- `src/components/PlayerList.tsx` - remove button for hosts
- `src/components/DraggableRankList.tsx` - max_ranks enforcement
- `src/app/api/rounds/route.ts` - profanity filter on options
- `src/app/api/rounds/join/route.ts` - profanity filter on display names
- `src/types/database.ts` - timer_minutes, max_ranks fields
- `src/lib/realtime.ts` - onPlayerRemoved subscription
- `supabase/schema.sql` - added ranking_started_at, reveal_view_state columns

---

## verification
- [ ] `npm run build` passes
- [ ] `npm test` passes
- [ ] Vercel deployment live
- [ ] Supabase schema matches `supabase/schema.sql` (run migration: `ALTER TABLE rounds ADD COLUMN IF NOT EXISTS ranking_started_at timestamptz`)
